{% extends 'base.html' %}

{% block title %}Registrar Atención Médica - {{ mascota.nombre }}{% endblock %}

{% block content %}
<div style="max-width: 1200px; margin: 0 auto; padding: 20px;">
    <!-- Título principal -->
    <div style="text-align: center; margin-bottom: 30px;">
        <h2 style="color: #333; font-size: 1.8rem; margin-bottom: 10px;">Registrar Atención Médica</h2>
        <p style="color: #666; font-size: 1rem;">Registro de nueva atención médica para mascota</p>
    </div>

    {% if mensaje_exito %}
    <div style="background-color: #d4edda; color: #155724; padding: 12px; border-radius: 4px; margin-bottom: 20px; border: 1px solid #c3e6cb;">
        <i class="fas fa-check-circle" style="margin-right: 8px;"></i>
        {{ mensaje_exito }}
    </div>
    {% endif %}

    <form method="post" enctype="multipart/form-data" id="atencion-form">
        {% csrf_token %}
        
        <!-- DATOS DEL TUTOR -->
        <div style="background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); padding: 25px; margin-bottom: 20px;">
            <h3 style="color: #333; font-size: 1.2rem; margin-bottom: 20px; border-bottom: 2px solid #007bff; padding-bottom: 10px;">
                <i class="fas fa-user" style="margin-right: 8px;"></i>
                DATOS DEL TUTOR
            </h3>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px;">
                <div>
                    <label style="display: block; font-weight: bold; color: #666; font-size: 0.65rem; margin-bottom: 5px;">RUT</label>
                    <input type="text" value="{{ mascota.id_tutor.nro_documento }}" readonly style="width: 100%; padding: 10px 12px; border: 1px solid #ccc; border-radius: 4px; background-color: #f8f9fa; color: #333; box-sizing: border-box; font-size: 0.65rem;">
                </div>
                <div>
                    <label style="display: block; font-weight: bold; color: #666; font-size: 0.65rem; margin-bottom: 5px;">Nombres</label>
                    <input type="text" value="{{ mascota.id_tutor.nombres }}" readonly style="width: 100%; padding: 10px 12px; border: 1px solid #ccc; border-radius: 4px; background-color: #f8f9fa; color: #333; box-sizing: border-box; font-size: 0.65rem;">
                </div>
                <div>
                    <label style="display: block; font-weight: bold; color: #666; font-size: 0.65rem; margin-bottom: 5px;">Apellidos</label>
                    <input type="text" value="{{ mascota.id_tutor.apellido_paterno }} {{ mascota.id_tutor.apellido_materno }}" readonly style="width: 100%; padding: 10px 12px; border: 1px solid #ccc; border-radius: 4px; background-color: #f8f9fa; color: #333; box-sizing: border-box; font-size: 0.65rem;">
                </div>
            </div>
        </div>

        <!-- DATOS DE LA MASCOTA -->
        <div style="background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); padding: 25px; margin-bottom: 20px;">
            <h3 style="color: #333; font-size: 1.2rem; margin-bottom: 20px; border-bottom: 2px solid #007bff; padding-bottom: 10px;">
                <i class="fas fa-paw" style="margin-right: 8px;"></i>
                DATOS DE LA MASCOTA
            </h3>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px;">
                <div>
                    <label style="display: block; font-weight: bold; color: #666; font-size: 0.65rem; margin-bottom: 5px;">Nombre</label>
                    <input type="text" value="{{ mascota.nombre }}" readonly style="width: 100%; padding: 10px 12px; border: 1px solid #ccc; border-radius: 4px; background-color: #f8f9fa; color: #333; box-sizing: border-box; font-size: 0.65rem;">
                </div>
                <div>
                    <label style="display: block; font-weight: bold; color: #666; font-size: 0.65rem; margin-bottom: 5px;">Especie</label>
                    <input type="text" value="{{ mascota.id_especie.nombre }}" readonly style="width: 100%; padding: 10px 12px; border: 1px solid #ccc; border-radius: 4px; background-color: #f8f9fa; color: #333; box-sizing: border-box; font-size: 0.65rem;">
                </div>
                <div>
                    <label style="display: block; font-weight: bold; color: #666; font-size: 0.65rem; margin-bottom: 5px;">Clínica</label>
                    {{ form.id_clinica }}
                    {% if form.id_clinica.errors %}
                    <div style="color: #dc3545; font-size: 0.7rem; margin-top: 5px;">
                        {% for error in form.id_clinica.errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- INFORMACIÓN DE LA ATENCIÓN -->
        <div style="background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); padding: 25px; margin-bottom: 20px;">
            <h3 style="color: #333; font-size: 1.2rem; margin-bottom: 20px; border-bottom: 2px solid #007bff; padding-bottom: 10px;">
                <i class="fas fa-stethoscope" style="margin-right: 8px;"></i>
                INFORMACIÓN DE LA ATENCIÓN
            </h3>
            
            <!-- Primera fila -->
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 15px;">
                <div>
                    <label for="{{ form.fecha_atencion.id_for_label }}" style="display: block; font-weight: bold; color: #666; font-size: 0.65rem; margin-bottom: 5px;">Fecha de Atención</label>
                    {{ form.fecha_atencion }}
                    {% if form.fecha_atencion.errors %}
                    <div style="color: #dc3545; font-size: 0.7rem; margin-top: 5px;">
                        {% for error in form.fecha_atencion.errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
                <div>
                    <label for="{{ form.id_personal.id_for_label }}" style="display: block; font-weight: bold; color: #666; font-size: 0.65rem; margin-bottom: 5px;">Doctor(a)</label>
                    {{ form.id_personal }}
                    {% if form.id_personal.errors %}
                    <div style="color: #dc3545; font-size: 0.7rem; margin-top: 5px;">
                        {% for error in form.id_personal.errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
                <div>
                    <label for="{{ form.id_servicio_detalle.id_for_label }}" style="display: block; font-weight: bold; color: #666; font-size: 0.65rem; margin-bottom: 5px;">Servicio Prestado</label>
                    {{ form.id_servicio_detalle }}
                    {% if form.id_servicio_detalle.errors %}
                    <div style="color: #dc3545; font-size: 0.7rem; margin-top: 5px;">
                        {% for error in form.id_servicio_detalle.errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Segunda fila -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 15px;">
                <div>
                    <label for="{{ form.peso.id_for_label }}" style="display: block; font-weight: bold; color: #666; font-size: 0.65rem; margin-bottom: 5px;">Peso (kg)</label>
                    {{ form.peso }}
                    {% if form.peso.errors %}
                    <div style="color: #dc3545; font-size: 0.7rem; margin-top: 5px;">
                        {% for error in form.peso.errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
                <div>
                    <label for="{{ form.temperatura.id_for_label }}" style="display: block; font-weight: bold; color: #666; font-size: 0.65rem; margin-bottom: 5px;">Temperatura (°C)</label>
                    {{ form.temperatura }}
                    {% if form.temperatura.errors %}
                    <div style="color: #dc3545; font-size: 0.7rem; margin-top: 5px;">
                        {% for error in form.temperatura.errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Motivo de atención -->
            <div style="margin-bottom: 15px;">
                <label for="{{ form.motivo_atencion.id_for_label }}" style="display: block; font-weight: bold; color: #666; font-size: 0.65rem; margin-bottom: 5px;">Motivo de la Atención</label>
                {{ form.motivo_atencion }}
                {% if form.motivo_atencion.errors %}
                <div style="color: #dc3545; font-size: 0.7rem; margin-top: 5px;">
                    {% for error in form.motivo_atencion.errors %}
                        {{ error }}
                    {% endfor %}
                </div>
                {% endif %}
            </div>
        </div>

        <!-- DETALLE CLÍNICO, DIAGNÓSTICO Y TRATAMIENTO -->
        <div style="background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); padding: 25px; margin-bottom: 20px;">
            <h3 style="color: #333; font-size: 1.2rem; margin-bottom: 20px; border-bottom: 2px solid #007bff; padding-bottom: 10px;">
                <i class="fas fa-notes-medical" style="margin-right: 8px;"></i>
                DETALLE CLÍNICO, DIAGNÓSTICO Y TRATAMIENTO
            </h3>
            
            <div style="display: grid; grid-template-columns: 1fr; gap: 15px;">
                <div>
                    <label for="{{ form.detalle_clinico.id_for_label }}" style="display: block; font-weight: bold; color: #666; font-size: 0.65rem; margin-bottom: 5px;">Detalle Clínico</label>
                    {{ form.detalle_clinico }}
                    {% if form.detalle_clinico.errors %}
                    <div style="color: #dc3545; font-size: 0.7rem; margin-top: 5px;">
                        {% for error in form.detalle_clinico.errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
                
                <div>
                    <label for="{{ form.diagnostico.id_for_label }}" style="display: block; font-weight: bold; color: #666; font-size: 0.65rem; margin-bottom: 5px;">Diagnóstico</label>
                    {{ form.diagnostico }}
                    {% if form.diagnostico.errors %}
                    <div style="color: #dc3545; font-size: 0.7rem; margin-top: 5px;">
                        {% for error in form.diagnostico.errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
                
                <div>
                    <label for="{{ form.tratamiento.id_for_label }}" style="display: block; font-weight: bold; color: #666; font-size: 0.65rem; margin-bottom: 5px;">Tratamiento</label>
                    {{ form.tratamiento }}
                    {% if form.tratamiento.errors %}
                    <div style="color: #dc3545; font-size: 0.7rem; margin-top: 5px;">
                        {% for error in form.tratamiento.errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- ADJUNTAR DOCUMENTOS -->
        <div style="background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); padding: 25px; margin-bottom: 20px;">
            <h3 style="color: #333; font-size: 1.2rem; margin-bottom: 20px; border-bottom: 2px solid #007bff; padding-bottom: 10px;">
                <i class="fas fa-paperclip" style="margin-right: 8px;"></i>
                ADJUNTAR DOCUMENTOS
            </h3>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px;">
                <!-- Documento 1 -->
                <div>
                    <label style="display: block; font-weight: bold; color: #666; font-size: 0.65rem; margin-bottom: 5px;">Tipo de Documento</label>
                    <select name="tipo_documento_1" style="width: 100%; padding: 10px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 0.65rem; background-color: white;">
                        <option value="">Seleccione tipo</option>
                        <option value="RADIOGRAFIA">Radiografía</option>
                        <option value="ANALISIS_SANGRE">Análisis de Sangre</option>
                        <option value="ECOGRAFIA">Ecografía</option>
                        <option value="HISTORIA_CLINICA">Historia Clínica</option>
                        <option value="RECETA">Receta</option>
                        <option value="CERTIFICADO">Certificado</option>
                        <option value="OTRO">Otro</option>
                    </select>
                </div>
                <div>
                    <label style="display: block; font-weight: bold; color: #666; font-size: 0.65rem; margin-bottom: 5px;">Archivo</label>
                    <input type="file" name="archivo_1" accept=".pdf,.jpg,.jpeg,.png" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 0.65rem;">
                </div>
                <div style="display: flex; align-items: end;">
                    <button type="button" class="btn-cargar" data-doc="1" style="background-color: #28a745; color: white; border: none; padding: 10px 15px; border-radius: 4px; font-size: 0.65rem; cursor: pointer;">
                        <i class="fas fa-upload" style="margin-right: 5px;"></i>
                        Cargar
                    </button>
                </div>

                <!-- Documento 2 -->
                <div>
                    <label style="display: block; font-weight: bold; color: #666; font-size: 0.65rem; margin-bottom: 5px;">Tipo de Documento</label>
                    <select name="tipo_documento_2" style="width: 100%; padding: 10px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 0.65rem; background-color: white;">
                        <option value="">Seleccione tipo</option>
                        <option value="RADIOGRAFIA">Radiografía</option>
                        <option value="ANALISIS_SANGRE">Análisis de Sangre</option>
                        <option value="ECOGRAFIA">Ecografía</option>
                        <option value="HISTORIA_CLINICA">Historia Clínica</option>
                        <option value="RECETA">Receta</option>
                        <option value="CERTIFICADO">Certificado</option>
                        <option value="OTRO">Otro</option>
                    </select>
                </div>
                <div>
                    <label style="display: block; font-weight: bold; color: #666; font-size: 0.65rem; margin-bottom: 5px;">Archivo</label>
                    <input type="file" name="archivo_2" accept=".pdf,.jpg,.jpeg,.png" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 0.65rem;">
                </div>
                <div style="display: flex; align-items: end;">
                    <button type="button" class="btn-cargar" data-doc="2" style="background-color: #28a745; color: white; border: none; padding: 10px 15px; border-radius: 4px; font-size: 0.65rem; cursor: pointer;">
                        <i class="fas fa-upload" style="margin-right: 5px;"></i>
                        Cargar
                    </button>
                </div>

                <!-- Documento 3 -->
                <div>
                    <label style="display: block; font-weight: bold; color: #666; font-size: 0.65rem; margin-bottom: 5px;">Tipo de Documento</label>
                    <select name="tipo_documento_3" style="width: 100%; padding: 10px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 0.65rem; background-color: white;">
                        <option value="">Seleccione tipo</option>
                        <option value="RADIOGRAFIA">Radiografía</option>
                        <option value="ANALISIS_SANGRE">Análisis de Sangre</option>
                        <option value="ECOGRAFIA">Ecografía</option>
                        <option value="HISTORIA_CLINICA">Historia Clínica</option>
                        <option value="RECETA">Receta</option>
                        <option value="CERTIFICADO">Certificado</option>
                        <option value="OTRO">Otro</option>
                    </select>
                </div>
                <div>
                    <label style="display: block; font-weight: bold; color: #666; font-size: 0.65rem; margin-bottom: 5px;">Archivo</label>
                    <input type="file" name="archivo_3" accept=".pdf,.jpg,.jpeg,.png" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 0.65rem;">
                </div>
                <div style="display: flex; align-items: end;">
                    <button type="button" class="btn-cargar" data-doc="3" style="background-color: #28a745; color: white; border: none; padding: 10px 15px; border-radius: 4px; font-size: 0.65rem; cursor: pointer;">
                        <i class="fas fa-upload" style="margin-right: 5px;"></i>
                        Cargar
                    </button>
                </div>
            </div>
        </div>

        <!-- BOTONES DE ACCIÓN -->
        <div style="text-align: center; margin-top: 30px;">
            <button type="submit" id="btn-registrar" style="background-color: #007bff; color: white; border: none; padding: 15px 40px; border-radius: 4px; font-size: 1rem; cursor: pointer; margin-right: 15px; transition: background-color 0.3s;">
                <i class="fas fa-save" style="margin-right: 8px;"></i>
                Registrar Atención Médica
            </button>
            
            <button type="button" id="btn-finalizar" disabled style="background-color: #6c757d; color: white; border: none; padding: 15px 40px; border-radius: 4px; font-size: 1rem; cursor: not-allowed; transition: background-color 0.3s;">
                <i class="fas fa-check-double" style="margin-right: 8px;"></i>
                Finalizar Registro de Atención
            </button>
        </div>
    </form>
</div>

<style>
    .form-control:focus {
        border-color: #007bff;
        box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
    }
    
    button:hover:not(:disabled) {
        background-color: #0056b3 !important;
    }
    
    .btn-cargar:hover {
        background-color: #218838 !important;
    }
    
    button:disabled {
        opacity: 0.6;
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Botones de cargar documentos
    const btnCargar = document.querySelectorAll('.btn-cargar');
    btnCargar.forEach(btn => {
        btn.addEventListener('click', function() {
            const docNum = this.getAttribute('data-doc');
            const tipoSelect = document.querySelector(`select[name="tipo_documento_${docNum}"]`);
            const archivoInput = document.querySelector(`input[name="archivo_${docNum}"]`);
            
            if (!tipoSelect.value) {
                alert('Por favor seleccione un tipo de documento');
                return;
            }
            
            if (!archivoInput.files[0]) {
                alert('Por favor seleccione un archivo');
                return;
            }
            
            // Aquí se podría implementar la carga AJAX si es necesario
            alert('Documento cargado correctamente');
        });
    });
    
    // Validación del formulario
    const form = document.getElementById('atencion-form');
    const btnRegistrar = document.getElementById('btn-registrar');
    const btnFinalizar = document.getElementById('btn-finalizar');
    
    form.addEventListener('submit', function(e) {
        // Validaciones básicas
        const fechaAtencion = document.querySelector('input[name="fecha_atencion"]').value;
        const doctor = document.querySelector('select[name="id_personal"]').value;
        const servicio = document.querySelector('select[name="id_servicio_detalle"]').value;
        const motivo = document.querySelector('textarea[name="motivo_atencion"]').value;
        
        if (!fechaAtencion || !doctor || !servicio || !motivo.trim()) {
            e.preventDefault();
            alert('Por favor complete todos los campos obligatorios');
            return;
        }
    });
    
    // Habilitar botón finalizar después de registrar
    if (document.querySelector('.alert-success')) {
        btnFinalizar.disabled = false;
        btnFinalizar.style.backgroundColor = '#28a745';
        btnFinalizar.style.cursor = 'pointer';
    }
});
</script>
{% endblock %}
